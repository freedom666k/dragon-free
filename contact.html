<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تواصل معنا - DRAGON FREE</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/main.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
<header>تواصل معنا - DRAGON FREE</header>
<div style="text-align:center; margin:10px;">
    <button onclick="toggleMode()">وضع ليلي/نهاري</button>
    <a href="index.html"><button>العودة للرئيسية</button></a>
</div>

<div class="container">
    <div class="card">
        <h3><i class="fas fa-envelope"></i> أرسل لنا رسالة</h3>
        <form onsubmit="sendMessage(event)">
            <input type="text" id="discord" placeholder="معرف الديسكورد" pattern="[0-9]{17,19}">
            <textarea id="message" placeholder="اكتب رسالتك هنا..." required></textarea>
            <button type="submit" id="submitBtn">إرسال</button>
        </form>
        <p id="status"></p>
    </div>
</div>

<script>
// إرسال الرسالة عبر Discord Webhook
async function sendMessage(e) {
    e.preventDefault();
    
    const discord = document.getElementById('discord').value;
    const message = document.getElementById('message').value;
    const submitBtn = document.getElementById('submitBtn');
    const status = document.getElementById('status');
    
    // تعطيل الزر أثناء الإرسال
    submitBtn.disabled = true;
    submitBtn.textContent = 'جاري الإرسال...';
    status.textContent = '';
    
    const webhookURL = 'https://discord.com/api/webhooks/1429173843494178856/CU1t2MZS0QGyZQT7FG-DGgjrOvRKijsCustfv-i0aEghedOZ44U_DTK-owxj3SkhQVUw';
    
    // إنشاء محتوى الرسالة مع المنشن
    const content = `العضو: <@${discord}>`;
    
    const payload = {
        content: content,
        embeds: [{
            title: ' رسالة جديدة من الموقع',
            color: 16711680, // اللون الأحمر
            fields: [
                {
                    name: ' معرف الديسكورد',
                    value: discord,
                    inline: false
                },
                {
                    name: ' الرسالة',
                    value: message,
                    inline: false
                }
            ],
            timestamp: new Date().toISOString(),
            footer: {
                text: 'DRAGON FREE Contact Form'
            }
        }]
    };
    
    try {
        // إرسال الرسالة الأولى (الـ Embed)
        const response1 = await fetch(webhookURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload)
        });
        
        if (!response1.ok) {
            throw new Error('فشل الإرسال');
        }
        
        // الانتظار قليلاً قبل إرسال الرسالة الثانية
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // إرسال الرسالة الثانية (منشن الرتبة)
        const response2 = await fetch(webhookURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                content: '<@&1378647724039344149>'
            })
        });
        
        if (response2.ok) {
            status.textContent = '✅ تم إرسال رسالتك بنجاح! سنرد عليك قريباً.';
            status.style.color = 'green';
            // مسح الحقول
            document.getElementById('name').value = '';
            document.getElementById('email').value = '';
            document.getElementById('discord').value = '';
            document.getElementById('message').value = '';
        } else {
            throw new Error('فشل الإرسال');
        }
    } catch (error) {
        status.textContent = '❌ حدث خطأ أثناء الإرسال. حاول مرة أخرى.';
        status.style.color = 'red';
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'إرسال';
    }
}
</script>

<footer>DRAGON FREE © 2025</footer>
</body>
</html>
